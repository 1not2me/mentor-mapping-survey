<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>מיפוי מדריכים לשיבוץ סטודנטים - שנת הכשרה תשפ"ו</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="page-wrap">

  <!-- HEADER -->
  <header class="hero">
    <div class="hero-icon">📋</div>
    <div class="hero-text">
      <h1>מיפוי מדריכים לשיבוץ סטודנטים - שנת הכשרה תשפ"ו</h1>
      <p>
        שלום רב, מטרת טופס זה היא לאסוף מידע עדכני על מדריכים ומוסדות לקראת שיבוץ הסטודנטים לשנה הקרובה.
        אנא מלא/י את כל השדות בצורה מדויקת. המידע ישמש לצורך תכנון השיבוץ בלבד.
      </p>
    </div>
  </header>

  <!-- FLASH MESSAGES -->
  <div class="messages">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="msg msg-{{ category }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!-- FORM CARD -->
  <main>
    <form method="post" class="form-card">

      <!-- פרטים אישיים -->
      <section class="form-section">
        <h2>פרטים אישיים</h2>

        <label>
          שם פרטי <span class="req">*</span>
          <input type="text" name="first_name" required>
        </label>

        <label>
          שם משפחה <span class="req">*</span>
          <input type="text" name="last_name" required>
        </label>

        <label>
          סטטוס מדריך <span class="req">*</span>
          <select name="mentor_status" required>
            <option value="">בחר/י מהאפשרויות</option>
            <option value="מדריך חדש (נדרש קורס)">מדריך חדש (נדרש קורס)</option>
            <option value="מדריך ותיק">מדריך ותיק</option>
            <option value="רכז/ת">רכז/ת</option>
          </select>
        </label>
      </section>

      <!-- מוסד ההכשרה -->
      <section class="form-section">
        <h2>מוסד ההכשרה</h2>

        <label>
          שם המוסד <span class="req">*</span>
          <input type="text" name="institute" required>
        </label>

        <label>
          תחום התמחות <span class="req">*</span>
          <select name="specialization" required>
            <option value="">בחר/י מהרשימה</option>
            {% for s in specializations %}
              <option value="{{ s }}">{{ s }}</option>
            {% endfor %}
          </select>
        </label>
      </section>

      <!-- כתובת המוסד -->
      <section class="form-section">
        <h2>כתובת המוסד</h2>

        <label>
          רחוב <span class="req">*</span>
          <input type="text" name="street" required>
        </label>

        <label>
          עיר <span class="req">*</span>
          <input type="text" name="city" required>
        </label>

        <label>
          מיקוד <span class="req">*</span>
          <input type="text" name="postal_code" required>
        </label>
      </section>

      <!-- קליטת סטודנטים -->
      <section class="form-section">
        <h2>קליטת סטודנטים</h2>

        <label>
          מספר סטודנטים שניתן לקלוט (1 או 2) <span class="req">*</span>
          <select name="num_students" required>
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </label>
      </section>

      <!-- המשכיות הדרכה -->
      <section class="form-section">
        <h2>המשכיות הדרכה</h2>
        <div class="radio-group">
          <label>
            <input type="radio" name="continue_mentoring" value="כן" required>
            כן
          </label>
          <label>
            <input type="radio" name="continue_mentoring" value="לא" required>
            לא
          </label>
        </div>
      </section>

      <!-- בקשות מיוחדות -->
      <section class="form-section">
        <h2>בקשות מיוחדות</h2>
        <label>
          בקשות מיוחדות (למשל: הדרכה בערב, שפות, נגישות, אילוצים)
          <textarea name="special_requests" rows="3"
                    placeholder="כתוב/י כאן כל בקשה שתרצה שניקח בחשבון בשיבוץ"></textarea>
        </label>
      </section>

      <!-- חוות דעת על המדריך - רשימה נפתחת עם צ'יפים -->
      <section class="form-section">
        <h2>חוות דעת על המדריך</h2>

        <div class="tag-ms" data-ms="mentor_feedback">
          <div class="control">
            <div class="chips" data-ms-chips></div>
            <div class="placeholder">
              בחר/י נקודות רלוונטיות (אפשר יותר מאפשרות אחת)
            </div>
            <div class="caret"></div>
          </div>

          <div class="menu">
            <div class="item" data-value="זמינות גבוהה">
              זמינות גבוהה <span class="check">✓</span>
            </div>
            <div class="item" data-value="ליווי מקצועי משמעותי">
              ליווי מקצועי משמעותי <span class="check">✓</span>
            </div>
            <div class="item" data-value="שיתוף פעולה עם המוסד">
              שיתוף פעולה עם המוסד <span class="check">✓</span>
            </div>
            <div class="item" data-value="צורך בחיזוק בליווי">
              צורך בחיזוק בליווי <span class="check">✓</span>
            </div>
          </div>
        </div>

        <!-- select חבוי שנשלח לשרת -->
        <select name="mentor_feedback_points" id="mentor_feedback_points" multiple hidden>
          <option value="זמינות גבוהה"></option>
          <option value="ליווי מקצועי משמעותי"></option>
          <option value="שיתוף פעולה עם המוסד"></option>
          <option value="צורך בחיזוק בליווי"></option>
        </select>

        <label>
          כתיבה חופשית (פירוט נוסף)
          <textarea name="mentor_feedback_text" rows="3"
                    placeholder="כתוב/י כאן חוות דעת חופשית..."></textarea>
        </label>
      </section>

      <!-- פרטי התקשרות -->
      <section class="form-section">
        <h2>פרטי התקשרות</h2>

        <label>
          מספר טלפון <span class="req">*</span>
          <input type="tel" name="phone" required placeholder="0501234567">
        </label>

        <label>
          כתובת דוא"ל <span class="req">*</span>
          <input type="email" name="email" required placeholder="name@example.com">
        </label>
      </section>

      <!-- כפתור שליחה -->
      <div class="submit-wrap">
        <button type="submit">
          <span>📨</span>
          שליחת הטופס
        </button>
      </div>

    </form>
  </main>
</div>

<!-- סקריפט לרשימה הנפתחת עם צ'יפים -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const ms = document.querySelector('[data-ms="mentor_feedback"]');
  if (!ms) return;

  const control = ms.querySelector('.control');
  const menu = ms.querySelector('.menu');
  const chipsBox = ms.querySelector('[data-ms-chips]');
  const placeholder = ms.querySelector('.placeholder');
  const hiddenSelect = document.getElementById('mentor_feedback_points');

  function updatePlaceholder() {
    const hasSelected = hiddenSelect && hiddenSelect.selectedOptions.length > 0;
    placeholder.style.display = hasSelected ? 'none' : 'block';
  }

  function renderChips() {
    chipsBox.innerHTML = '';
    Array.from(hiddenSelect.selectedOptions).forEach(opt => {
      const chip = document.createElement('div');
      chip.className = 'chip';
      chip.dataset.value = opt.value;
      chip.innerHTML = opt.value + '<button type="button">&times;</button>';
      chip.querySelector('button').addEventListener('click', function () {
        setSelected(opt.value, false);
      });
      chipsBox.appendChild(chip);
    });
    updatePlaceholder();
  }

  function setSelected(value, on) {
    const option = Array.from(hiddenSelect.options).find(o => o.value === value);
    if (!option) return;
    option.selected = on;

    menu.querySelectorAll('.item').forEach(item => {
      if (item.dataset.value === value) {
        item.classList.toggle('active', on);
      }
    });

    renderChips();
  }

  control.addEventListener('click', function () {
    ms.classList.toggle('open');
  });

  menu.querySelectorAll('.item').forEach(item => {
    item.addEventListener('click', function () {
      const value = item.dataset.value;
      const option = Array.from(hiddenSelect.options).find(o => o.value === value);
      const shouldSelect = !(option && option.selected);
      setSelected(value, shouldSelect);
    });
  });

  document.addEventListener('click', function (e) {
    if (!ms.contains(e.target)) {
      ms.classList.remove('open');
    }
  });

  renderChips();
});
</script>

</body>
</html>

